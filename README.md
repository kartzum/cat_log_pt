# cat_log_pt

Прототип сервиса загрузки каталогов из ресурсов.

## Модель данных
Модель состоит из следующих сущностей.

* Provider (провайдер). Содержит информацию о поставщике данных.
* Catalog (каталог). Группирует часть информации, которая принадлежит провайдеру. Каталог может содержать подкаталоги.
* CatalogScheme (схема каталога). Описывает логическое содержимое каталога.
* CatalogSchemeOperation (операция схемы каталога). Описывает минимальную логическую часть содержания каталога.
* CatalogSchemeOperationInstance (содержимое операции каталога). Конкретное состояние части каталога.
* CatalogOperationInstanceResult (результат выполнения операции каталога). Результат части каталога.


```
Provider
  1|
  n|
 Catalog
  1|   1|
   |   1|
   |   CatalogScheme
   |      1|
   |      n|
   |     CatalogSchemeOperation
   |        1|
   |        1|
   |     CatalogSchemeOperationInstance    
   |         1|
  n|         1|
 CatalogOperationInstanceResult
```

## Сущности и последовательность для загрузки данных

* Для загрузки данных источника необходим провайдер.
* Для провайдера необходимы: схема и операции для схемы.
* Для загрузки конкретных данных необходимо создать каталог с определённой схемой.
* Необходимо выполнить все операции для каталога из схемы данных.
* Для успешной загруки необходимо, что бы были созданы все элементы состояния операций.
* Через операции можно получить конкретные результаты.

## Сценарии использования

Основная идея модели - это хранение информации о каталогах для провайдеров данных.
Сущности модели предназначены для хранения состояния по определнным каталогам и
могут хранить конкретные данные из каталога или только ссылки.

### Создание загрузки по расписанию
Для загрузки каталога по расписанию необходимо выполнить следующие группы операций.

Создание операций для каталога.
```
  -> | Выбрать элемент расписания | -> | Создать: каталог со схемой и операции | ->
```

Выполнение операций.
```
  -> | Выбрать новую операцию | -> | Выполнить операцию | -> | Отметить операцию выполненной | ->
```

При успешном выполнении всех операций по каталогу считается, что каталог загружен успешно.
При ошибках выполнение операций можно повторять. 
При достяжении определённого количества ошибок для каталога, загрука каталога прекращается.

Управление расписанием и запуском операций может быть выполнено сторонними сервисами.

Результаты выполнения операций могут быть сохранены в сторонних хранилищах.

### Создание новой операции
Для создания новой операции необходимо.
* Добавить новую операцию в схему.
* Добавить новую логику выполнения. Логика может выполняться как внутри так и во внешних сервисах.

### Эволюция изменений при загрузке
При изменениях стурктуры и состава данных на стороне провайдера необходимо добавить новую схему.
Схема может содержать как новые операции так и старые.
При этом с историческими данными можно продолжать работать так как старая схема не меняется. 

### Масштабирование
Основную нагрузку создают процессы вополнения операций. 
Эти процессы можно вынести во внешние сервисы, 
а за сервисом оставить роль хранения мета информации о каталогах. 
Так как операции не зависимы, то и выполнять их можно параллельно.
Эта независимость позволяет масштабироваться горизонтально.

## Как запустить?

### Зависимости
```
pip install fastapi
pip install uvicorn
pip install playwright
```
### Запуск
Запустить main.py

### Загрузка
```
fetch('http://127.0.0.1:8000/schedule_catalog_scheme_operation/bb8c681b-fc5f-49d3-817d-7d5f50e811e0', {method: 'POST'})
```
### Результат
```
http://127.0.0.1:8000/catalog_results/
```
